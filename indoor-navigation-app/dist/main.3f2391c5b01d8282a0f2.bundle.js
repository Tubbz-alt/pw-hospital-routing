webpackJsonp([1],{0:function(e,t,n){e.exports=n("cDNt")},NgpJ:function(e,t,n){"use strict";var o=n("/oeL"),a=n("CPp0"),i=n("5v8a"),r=(n.n(i),n("p5Ee"));n.d(t,"a",function(){return c});var l=this&&this.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this._http=e,this._url=r.a.geoJsonUrl}return e.prototype.getGeoJson=function(){return this._http.get(this._url).map(function(e){return e.json()})},e}();c=l([n.i(o.d)(),s("design:paramtypes",["function"==typeof(p=void 0!==a.b&&a.b)&&p||Object])],c);var p},"aR8+":function(e,t,n){"use strict";var o=n("fc+i"),a=n("/oeL"),i=n("qbdv"),r=n("bm2B"),l=n("fL27"),s=n("wQAS"),c=n("CPp0"),p=n("a0oU"),d=n("Z04r");n.d(t,"a",function(){return h});var u=this&&this.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},h=function(){function e(){}return e}();h=u([n.i(a.b)({declarations:[s.a],imports:[o.a,l.a,i.a,r.a,c.a,d.a,d.b,p.a.forRoot({apiKey:"AIzaSyCuF0jO6w-aCgx7P28epp7zKGbNJwjlw6g"})],providers:[],bootstrap:[s.a]})],h)},cDNt:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("/oeL"),a=n("Qa4U"),i=n("aR8+");n("p5Ee").a.production&&n.i(o.a)(),n.i(a.a)().bootstrapModule(i.a)},efyd:function(e,t){e.exports='\x3c!-- Div to hold the map--\x3e\n<div [style.height]="mapHeight" #map class="mapContainer">\n</div>\n\n\x3c!-- HTML for infobar --\x3e\n<div class="infoBarContainer" #infoBarContainer id="infoBarContainer">\n  <md-grid-list cols="5" rowHeight="25" gutterSize="0px">\n    <md-grid-tile class="infoImageContainer" rowspan="5" [ngStyle]="{ \n        \'background\' : (selectedFeatureData.imageUrl) ?\n        \'url(\'+selectedFeatureData.imageUrl+\') no-repeat\':\n        \'url(/assets/images/corridor.png) no-repeat\'}">\n    </md-grid-tile>\n    <md-grid-tile colspan="3" rowspan="2" class="titleTile">\n      <div>\n        <h2 class="mat-title">{{selectedFeatureData.title}}</h2>\n        <h4 class="mat-subheading-1">{{selectedFeatureData.subtitle}}</h4>\n      </div>\n    </md-grid-tile>\n    <md-grid-tile rowspan="5" class="scanBtnContainer">\n      <button md-fab class="scanBtn" (click)="scanBtnClick($event)">\n        <md-icon>my_location</md-icon>\n      </button>\n      <button md-icon-button [mdMenuTriggerFor]="menu" class="moreButton">\n        <md-icon>more_vert</md-icon>\n      </button>\n    </md-grid-tile>\n    <md-grid-tile colspan="3" rowspan="2" class="bodyTile">\n      <p class="mat-body-1">{{selectedFeatureData.description}}\n      </p>\n    </md-grid-tile>\n    <md-grid-tile colspan="3" class="footerTile" \n      [class.topborder]="selectedFeatureData.openTime || selectedFeatureData.website">\n      <div class="attachmentContainer">\n        <div *ngIf="selectedFeatureData.openTime" class="attachment">\n          <div class="attachMentIconContainer">\n            <md-icon class="smallIcon">access_time</md-icon>\n          </div>\n          <div class="attachMentValueContainer time">\n            {{selectedFeatureData.openTime}}\n          </div>\n        </div>\n        <div *ngIf="selectedFeatureData.website" class="attachment">\n          <div class="attachMentIconContainer">\n            <md-icon class="smallIcon">language</md-icon>\n          </div>\n          <div class="attachMentValueContainer link">\n            <a href="" href="http://{{selectedFeatureData.website}}" target="_blank">\n                {{selectedFeatureData.website}}\n            </a>\n          </div>\n        </div>\n      </div>\n    </md-grid-tile>\n  </md-grid-list>\n</div>\n\n<md-menu #menu="mdMenu">\n  <button md-menu-item disabled>\n    <span>Level {{selectedLevel}}</span>\n  </button>\n  <button *ngFor="let option of optionsForSelect" \n    md-menu-item (click)="selectChanged(option)">\n    \x3c!--<md-icon>voicemail</md-icon>--\x3e\n    <span>{{option.name}}</span>\n  </button>\n</md-menu>\n\n<div class="levelButtonContainer" id="layerSwitcher">\n  <div *ngFor="let level of indoorLevels" class="levelButton mat-body-1" [class.levelSelected]="selectedLevel==level" (click)="levelChangeClick($event)" [attr.data-value]="level">{{level}}</div>\n</div>\n\n<div id="beaconTester">\n  <md-input-container>\n    <input mdInput placeholder="Beacon ref ID" value="1" id="beaconRefTxt">\n  </md-input-container>\n  <button md-raised-button (click)="testScanBtnClick($event)">Go</button>\n</div>'},hxJY:function(e,t,n){t=e.exports=n("rP7Y")(!1),t.push([e.i,".mapContainer{height:100%!important}@media (min-width:320px){.infoBarContainer{width:100vw;margin:20px}}@media (min-width:481px){.infoBarContainer{width:100vw;margin:20px}}@media (min-width:641px){.infoBarContainer{width:90vw;margin:20px}}@media (min-width:961px){.infoBarContainer{width:60vw;margin:20px}}@media (min-width:1025px){.infoBarContainer{width:50vw;margin:20px}}@media (min-width:1281px){.infoBarContainer{width:40vw;margin:20px}}.infoBarContainer h2,.infoBarContainer h4{margin-bottom:2px;margin-left:10px}.infoBarContainer h2{margin-top:10px;line-height:15px!important}.infoBarContainer h5{line-height:15px!important;color:#2e2e2e}.infoBarContainer p.mat-body-1{margin:10px}.attachmentContainer{margin-left:10px}.smallIcon{font-size:15px;height:15px;width:15px;color:#4285f4}.attachment,.attachMentIconContainer,.attachMentValueContainer{float:left}.attachMentValueContainer.time{padding-top:2px;padding-left:5px;padding-right:10px}.attachMentValueContainer.link{padding-top:1px;padding-left:5px}.attachMentValueContainer.link a{text-decoration:none}.scanBtn{background-color:#4285f4}md-grid-tile{background:#fff;color:#282828}.titleTile{background-color:#4285f4;color:#fff}.bodyTile,.footerTile{background-color:#f8f8f8}.topborder{border-top:1px solid #f0f0f0}.moreButton{float:right;top:0;right:0;position:absolute;color:gray}.levelButtonContainer{-moz-user-select:none;box-shadow:0 1px 4px -1px rgba(0,0,0,.3);border-radius:2px;cursor:pointer;background-color:#fff;width:28px;margin-right:10px}.levelButton{position:relative;width:28px;height:27px;left:0;top:0;text-align:center;line-height:27px}.levelButton:hover,.levelSelected{font-weight:700}.levelSelected{background:#f1f1f1}md-grid-tile>/deep/ figure{-webkit-box-pack:start!important;-ms-flex-pack:start!important;justify-content:flex-start!important}.scanBtnContainer>/deep/ figure{-webkit-box-pack:center!important;-ms-flex-pack:center!important;justify-content:center!important}#beaconTester{background:#fff}.infoImageContainer{background-size:100%!important}",""]),e.exports=e.exports.toString()},n7du:function(e,t){function n(e){throw new Error("Cannot find module '"+e+"'.")}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="n7du"},p5Ee:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o={production:!0,geoJsonUrl:"assets/pg.json"}},wQAS:function(e,t,n){"use strict";var o=n("/oeL"),a=n("a0oU"),i=n("NgpJ"),r=n("qj/s"),l=(n.n(r),n("JGKl"));n.n(l);n.d(t,"a",function(){return p});var s=this&&this.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n){this._indoorDataService=e,this.mapApi=t,this._chRef=n,this.lat=12.992634899999999,this.lng=77.71721695,this.zoom=28,this.mapHeight="100%",this.indoorLevels=[],this.selectedLevel=0,this.mapFillColor="#FFFFDD",this.mapStrokeColor="#CFA992",this.selectedFeatureData={ref:null,title:null,subtitle:null,description:null,beaconAttached:null,beaconRef:null,website:null,openTime:null,imageUrl:null},this.isDisabled=!1,this.beaconMarkers={},this.pathCovered={},this.pathPolyLine={}}return e.prototype.getGeoJSON=function(){var e=this;this._indoorDataService.getGeoJson().subscribe(function(t){e.geoJsonObject=t.geoJson,e.lat=t.center.lat,e.lng=t.center.lng,e.zoom=t.zoomLevel})},e.prototype.ngOnInit=function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;this.infoBarWidth=e/2+"px",this.getGeoJSON(),this.initMap()},e.prototype.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.prototype.initMap=function(){var e=this;this.mapApi.createMap(this.m.nativeElement,{streetViewControl:!1,zoomControl:!0,zoomControlOptions:{position:7},mapTypeControl:!0,mapTypeId:"roadmap",mapTypeControlOptions:{mapTypeIds:["hybrid","roadmap","satellite"],position:1},center:{lat:this.lat,lng:this.lng},zoom:this.zoom}).then(function(){return e.mapApi.getNativeMap().then(function(t){e._map=t;var n=e;e._map.data.addGeoJson(e.geoJsonObject);var o={};e._map.data.forEach(function(t){if(t.getProperty("building")&&(n.selectedFeatureData=n.extractFeatureData(t)),t.getProperty("ref:beacon")&&e.addBeaconMarker(t),!t.getProperty("stairs")&&!t.getProperty("highway")&&!t.getProperty("building")){var a=t.getProperty("level");e.selectedLevel=a,o[a]||(o[a]=!0,n.indoorLevels.push(a))}}),console.log(n.indoorLevels.sort().reverse()),setTimeout(function(){n.switchLevel()},300);var a=document.createElement("div"),i=document.getElementById("infoBarContainer");a.appendChild(i),t.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(a);var r=document.createElement("div"),l=document.getElementById("layerSwitcher");r.appendChild(l),t.controls[google.maps.ControlPosition.RIGHT_TOP].push(r);var s=document.createElement("div"),c=document.getElementById("beaconTester");s.appendChild(c),t.controls[google.maps.ControlPosition.TOP_CENTER].push(s),t.data.addListener("click",function(e){n.highLightFeature(e.feature,!1),n.updateInfoBar(e.feature),n._chRef.detectChanges()}),e.indoorLevels.forEach(function(e){n.pathCovered[e]=[],console.log(e),n.pathPolyLine[e]=new google.maps.Polyline({path:n.pathCovered[e],geodesic:!0,strokeColor:"gray",strokeOpacity:1,strokeWeight:1,map:n._map})})})})},e.prototype.highLightFeature=function(e,t){this._map.data.revertStyle(),this._map.data.overrideStyle(e,{strokeWeight:2,strokeColor:this.mapStrokeColor,fillColor:"yellow"});var n=this;this.getCenter(e,function(e){t&&n._map.panTo(e)})},e.prototype.updateInfoBar=function(e){this.selectedFeatureData=this.extractFeatureData(e)},e.prototype.extractFeatureData=function(e){var t={ref:null,title:null,subtitle:null,description:null,beaconAttached:null,beaconRef:null,website:null,openTime:null,imageUrl:null},n=(e.getProperty("ref"),e.getProperty("ref:beacon"));t.ref=e.getProperty("ref"),t.title=e.getProperty("name"),t.description=e.getProperty("note"),n?(t.beaconAttached=!0,t.beaconRef=n):t.beaconAttached=!1;var o=[];if(e.getProperty("indoor")){if(e.getProperty("indoor"),o.push(e.getProperty("indoor")),"room"){if(e.getProperty("room")){var a=e.getProperty("room");["stairs","toilets","toilet"].indexOf(a.toLowerCase())>=0?o.push("has "+a.toLowerCase()):(o.pop(),o.push(a))}e.getProperty("amenity")&&o.unshift(e.getProperty("amenity"))}t.subtitle=this.capitalizeFirstLetter(o.join(", "))}else if(e.getProperty("door")){var i=e.getProperty("door"),o=[];if("yes"==i.toLowerCase()?o.push("Door"):o.push(this.capitalizeFirstLetter(i)+" door"),e.getProperty("entrance")&&o.push(e.getProperty("entrance").toLowerCase()),e.getProperty("wheelchair")){var r=e.getProperty("wheelchair");"yes"==r.toLowerCase()?o.push("wheelchair allowed"):"no"==r?o.push("wheelchair not allowed"):o.push("limited wheelchair access")}t.subtitle=o.join(", ")}else if(e.getProperty("building")){var o=[];if(o.push(this.capitalizeFirstLetter(e.getProperty("building"))),e.getProperty("wheelchair")){var r=e.getProperty("wheelchair");"yes"==r.toLowerCase()?o.push("wheelchair allowed"):"no"==r?o.push("wheelchair not allowed"):o.push("limited wheelchair access")}t.subtitle=o.join(", ")}return e.getProperty("website")&&(t.website=e.getProperty("website")),e.getProperty("opening_hours")&&(t.openTime=e.getProperty("opening_hours")),e.getProperty("image_url")&&(t.imageUrl=e.getProperty("image_url")),t},e.prototype.levelChangeClick=function(e){console.log(e.target.dataset.value),this.selectedLevel=e.target.dataset.value,this.switchLevel()},e.prototype.testScanBtnClick=function(e){var t=this,n=document.getElementById("beaconRefTxt").value,o=t.beaconMarkers[n],a=o.feature,i=a.getProperty("level");if(t.selectedLevel=i,t.activeBeaconMarker){console.log(t.activeBeaconMarker);var r="assets/images/inactive.png";t.activeBeaconMarker.setIcon(r)}t.activeBeaconMarker=o;var r="assets/images/active.png";o.setIcon(r),t.switchLevel(),t.highLightFeature(a,!0),t.updateInfoBar(a),t.pathCovered[i].push({lat:o.getPosition().lat(),lng:o.getPosition().lng()}),t.pathPolyLine[i].setPath(t.pathCovered[i])},e.prototype.scanBtnClick=function(e){var t=this;this.scanForBeacons(function(e,n){if(null!=e)console.log(e);else{var o=n,a=t.beaconMarkers[o],i=a.feature,r=i.getProperty("level");if(t.selectedLevel=r,t.activeBeaconMarker){var l="assets/images/inactive.png";t.activeBeaconMarker.setIcon(l)}t.activeBeaconMarker=a;var l="assets/images/active.png";a.setIcon(l),t.switchLevel(),t.highLightFeature(i,!0),t.updateInfoBar(i),t.pathCovered[r].push({lat:a.getPosition().lat(),lng:a.getPosition().lng()}),t.pathPolyLine[r].setPath(t.pathCovered[r])}})},e.prototype.getCenter=function(e,t){"Polygon"===e.getGeometry().getType()||"LineString"===e.getGeometry().getType()?e.toGeoJson(function(e){var n=[];n[0]=[];for(var o=e.geometry.coordinates[0],a=0;a<o.length;a++)n[0].push([o[a][0],o[a][1]]);console.log(n);var i=l(n,1e-9,!0);console.log(i);var r=new google.maps.LatLng(i[1],i[0]);t(r)}):t(e.getGeometry().get())},e.prototype.switchLevel=function(){var e=this,t=this,n=[];this._map.data.setStyle(function(e){var o=e.getProperty("level"),a=o==t.selectedLevel;return a&&n.push({value:e.getProperty("ref"),name:e.getProperty("name")}),{icon:"assets/images/door.png",fillColor:t.mapFillColor,strokeColor:t.mapStrokeColor,strokeWeight:1,visible:a}});for(var o in this.beaconMarkers)this.beaconMarkers[o].feature.getProperty("level")==this.selectedLevel?this.beaconMarkers[o].setVisible(!0):this.beaconMarkers[o].setVisible(!1);for(var o in this.pathPolyLine)o!=this.selectedLevel?this.pathPolyLine[o].setVisible(!1):this.pathPolyLine[o].setVisible(!0);window.setTimeout(function(){e.optionsForSelect=n},500)},e.prototype.addBeaconMarker=function(e){var t=this;this.getCenter(e,function(n){var o=new google.maps.Marker({position:n,map:t._map,feature:e,icon:"assets/images/inactive.png"});t.beaconMarkers[e.getProperty("ref:beacon")]=o})},e.prototype.selectChanged=function(e){var t,n=e.value;this._map.data.forEach(function(e){e.getProperty("ref")==n&&(t=e)}),this.selectedLevel=t.getProperty("level"),this.switchLevel(),console.log(t),this.highLightFeature(t,!0),this.updateInfoBar(t)},e.prototype.scanForBeacons=function(e){var t={filters:[{services:["13333333-3333-3333-3333-333333333337"]}]};console.log("Requesting Bluetooth Device..."),navigator.bluetooth.requestDevice(t).then(function(e){return console.log("> Name:             "+e.name),console.log("> Id:               "+e.id),console.log("> Connected:        "+e.gatt.connected),e.gatt.connect()}).then(function(e){return e.getPrimaryService("13333333-3333-3333-3333-333333333337")}).then(function(e){return e.getCharacteristic("13333333-3333-3333-3333-333333330003")}).then(function(e){return e.readValue()}).then(function(t){var n=new r.TextDecoder("utf-8"),o=new URL(n.decode(t)),a=o.searchParams.get("ref_beacon");e(null,a)}).catch(function(t){console.log("Error: "+t),e(t,null)})},e}();s([n.i(o.z)("map"),c("design:type","function"==typeof(d=void 0!==o.m&&o.m)&&d||Object)],p.prototype,"m",void 0),p=s([n.i(o.l)({selector:"app-root",template:n("efyd"),styles:[n("hxJY")],providers:[i.a,a.b]}),c("design:paramtypes",["function"==typeof(u=void 0!==i.a&&i.a)&&u||Object,"function"==typeof(h=void 0!==a.b&&a.b)&&h||Object,"function"==typeof(g=void 0!==o.u&&o.u)&&g||Object])],p);var d,u,h,g}},[0]);